{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/rust-cant-handle-simple-task/","result":{"data":{"site":{"siteMetadata":{"title":"Blog","author":{"name":"Luchanskii Oleg"}}},"mdx":{"id":"65308a83-1dd9-5b6a-b5ee-b664cf4d24b8","excerpt":"tl;dr: gatsby and nodejs take a lot of memory. tl;dr2:  cargo install  execute in docker build very long time ( > 15 min), because they need download crates…","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How Gatsby, NodeJS, Rust can’t handle simple task 🦀\",\n  \"date\": \"2022-09-27\",\n  \"description\": \"I needed to build an email subscription - just take email and put it in database. Thats all...\",\n  \"favorite\": false,\n  \"heroImageFile\": \"./hero.jpg\",\n  \"heroImageAlt\": \"Cogs\",\n  \"tag\": \"Development\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"tl;dr: gatsby and nodejs take a lot of memory.\"), mdx(\"p\", null, \"tl;dr2: \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"cargo install\"), \" execute in docker build very long time ( > 15 min), because they need download crates index from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/rust-lang/crates.io-index/\"\n  }, \"github.com\"), \" wich size > 215 mb (avg download speed ~200 kb/sec).\"), mdx(\"h2\", null, \"How it all started\"), mdx(\"p\", null, \"I needed to build an email subscription - just take email and put it in database. Thats all.\"), mdx(\"p\", null, \"So this looking like single API, wich get email address (single string) from frontend and put in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://airtable.com/\"\n  }, \"airtable\"), \" (our stratup backend). We using \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"gatsbyjs.com\"\n  }, \"Gatsby\"), \" for static page generation, and Gatsby has \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.gatsbyjs.com/docs/reference/functions/\"\n  }, \"Functions\"), \":\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"jsx\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-jsx\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"export\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"default\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"handler\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"req\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" res\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  res\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"status\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"200\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"json\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"hello\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"world\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"p\", null, \"So, solution for email subscription:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"tsx\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-tsx\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"subscribe\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n  req\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" GatsbyFunctionRequest\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"<\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"string\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \">\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  res\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" GatsbyFunctionResponse\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" email \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token constant\"\n  }, \"JSON\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"parse\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"req\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"body\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"db\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"subscribers\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"create\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    createdAt\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Date\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"toISOString\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    email\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" res\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"json\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" status\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"ok\\\"\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")))), mdx(\"p\", null, \"We using docker for applications, and so we need rewrite our dockerfile:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"diff\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-diff\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-diff\"\n  }, \"FROM node:18-alpine3.15 AS builder\\n\\nWORKDIR /app\\n\\nRUN apk add vips-dev fftw-dev build-base python3 util-linux --update --no-cache\\nCOPY package.json yarn.lock .yarnrc.yml ./\\nCOPY .yarn ./.yarn\\nRUN yarn install\\nCOPY . .\\nRUN yarn gatsby telemetry --disable\\nRUN yarn build\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token deleted-sign deleted\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix deleted\"\n  }, \"-\"), \"FROM nginx:1.20-alpine\\n\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token inserted-sign inserted\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix inserted\"\n  }, \"+\"), \"FROM node:18-alpine3.15\\n\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token deleted-sign deleted\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix deleted\"\n  }, \"-\"), \"COPY ./nginx.conf /etc/nginx/nginx.conf\\n\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix deleted\"\n  }, \"-\"), \"COPY --from=builder ./app/public /usr/share/nginx/html/\\n\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token inserted-sign inserted\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix inserted\"\n  }, \"+\"), \"COPY --from=builder ./app /app\\n\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix inserted\"\n  }, \"+\"), \"WORKDIR /app\\n\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix inserted\"\n  }, \"+\"), \"RUN yarn install\\n\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix inserted\"\n  }, \"+\"), \"RUN yarn gatsby telemetry --disable\\n\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token prefix inserted\"\n  }, \"+\"), \"CMD [ \\\"yarn\\\", \\\"serve\\\", \\\"-H\\\", \\\"0.0.0.0\\\" ]\")))), mdx(\"p\", null, \"Now, application stop using Nginx, which take ~80mb memory, and starting using NodeJS with >512 mb memory. Little remark we use 1 GB memory hosting (cheaper digital ocean droplet).\"), mdx(\"p\", null, \"We stopped using this solution, because time to time we got error \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"out of memory\"), \". This is so expensive memory usage for single API call.\"), mdx(\"h2\", null, \"Try again, Rust way\"), mdx(\"p\", null, \"So I was trying using Rust. I choose \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://rocket.rs/\"\n  }, \"rocket\"), \" for web, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/seanmonstar/reqwest\"\n  }, \"reqwest\"), \" for calling Airtable API. Cargo.toml file:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"toml\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-toml\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-toml\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token table class-name\"\n  }, \"package\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"name\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"api\\\"\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"version\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"0.1.0\\\"\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"edition\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"2021\\\"\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token table class-name\"\n  }, \"dependencies\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"rocket\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"version\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"0.5.0-rc.2\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"features\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"secrets\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"reqwest\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"0.11\\\"\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"tokio\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"version\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"1\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key property\"\n  }, \"features\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"full\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")))), mdx(\"p\", null, \"So, I started from writing simple experiment Dockerfile:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"docker\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-docker\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-docker\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token instruction\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"FROM\"), \" rust:1.60\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token instruction\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"WORKDIR\"), \" /usr/src/myapp\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token instruction\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"COPY\"), \" . .\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token instruction\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"RUN\"), \" cargo install --path .\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token instruction\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"CMD\"), \" [\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\\"myapp\\\"\"), \"]\")))), mdx(\"p\", null, \"And when you trying build this simple image, it will get 15 - 30 min and you think \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/rust-lang/docker-rust/issues/111\"\n  }, \"building is stuck\"), \" at this moment:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"toml\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-toml\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-toml\"\n  }, \"Installing api v0\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1.0\"), \" (/usr/src/myapp)\\n    Updating crates\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"io index\"))), mdx(\"p\", null, \"Why it\\u2019s happen? When you try building application or install dependencies, thats require \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://doc.rust-lang.org/cargo/reference/registries.html#registries\"\n  }, \"cargo index\"), \".\"), mdx(\"h2\", null, \"Cargo Index\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/rust-lang/crates.io-index\"\n  }, \"This is git repostiory\"), \", wich contain index of crates for help searching it. Current size of index about ~100 mb, but in git with fully history it take about ~210 mb. When you start install dependencies in docker you need download full history from github, but github has speed limit for downloading (about 200 kb/sec). So, every time when you need build simple application, it will take 15 - 30 minutes. How it fix? \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/rust-lang/docker-rust/issues/111#issuecomment-1258513924\"\n  }, \"You can add the hack in dockerfile\"), \", but with some tradeoffs. Or you can skip downloading index, but only in nightly build (this feature unstable and can be change).\"), mdx(\"p\", null, \"When it can be fix with rust community? \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://rust-lang.github.io/rfcs/2789-sparse-index.html\"\n  }, \"There is RFC about this problem and solution (sparse-index)\"), \", so Rust development team activly build this feature, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/rust-lang/cargo/issues/9069\"\n  }, \"you can track the issue\"), \".\"), mdx(\"h2\", null, \"Whats next?\"), mdx(\"p\", null, \"I\\u2019ll try \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://go.dev/\"\n  }, \"golang\"), \" for single API, because this is not my way using a hack which can broke.\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"How Gatsby, NodeJS, Rust can’t handle simple task 🦀","date":"September 27, 2022","description":"I needed to build an email subscription - just take email and put it in database. Thats all...","tag":"Development","hidden":null,"heroImageLink":null,"heroImageFile":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#a8a8a8","images":{"fallback":{"src":"/static/fce4aea98b215c32142f36542c2530cb/04696/hero.jpg","srcSet":"/static/fce4aea98b215c32142f36542c2530cb/8cda2/hero.jpg 480w,\n/static/fce4aea98b215c32142f36542c2530cb/1e8d2/hero.jpg 960w,\n/static/fce4aea98b215c32142f36542c2530cb/04696/hero.jpg 1920w","sizes":"(min-width: 1920px) 1920px, 100vw"},"sources":[{"srcSet":"/static/fce4aea98b215c32142f36542c2530cb/7f36e/hero.webp 480w,\n/static/fce4aea98b215c32142f36542c2530cb/40ac1/hero.webp 960w,\n/static/fce4aea98b215c32142f36542c2530cb/ff6dd/hero.webp 1920w","type":"image/webp","sizes":"(min-width: 1920px) 1920px, 100vw"}]},"width":1920,"height":1296}}},"heroImageAlt":"Cogs","redirect":null},"timeToRead":1},"hidden":{"frontmatter":{"hidden":null}},"previous":null,"next":{"id":"60b91532-a379-598f-bf13-db5abdbc7917","slug":"docker-rust/","frontmatter":{"title":"Самый маленький Docker образ Rust приложения","date":"October 11, 2023","description":"Привет %username%, эта статья про то, как поместить Rust приложение в Docker и получить образ размером с бинарный файл (6 Мб). А также про причины, которые привели к переходу с NodeJS на Rust, отдельная пара слов о проблемах вначале, переходе на Go, и том, как команда Rust устранила эти проблемы.","tag":"Development","heroImageLink":"https://habrastorage.org/r/w1560/getpro/habr/upload_files/623/0d7/2bb/6230d72bb847cc3862dd5c1d3e4b2dec.png","heroImageFile":null},"timeToRead":1}},"pageContext":{"id":"65308a83-1dd9-5b6a-b5ee-b664cf4d24b8","previousPostId":null,"nextPostId":"60b91532-a379-598f-bf13-db5abdbc7917"}},"staticQueryHashes":["2841359383","864671932"]}